# generated by mBlock5 for CyberPi
# codes make you happy

import event, time, cyberpi, random

# === Variables ===
aircraft_step = 0
game_sta = 0
bullet_start = 0
score = 0

# Sprites
s_scroe = 0
s_bullet = 0
s_aircraft = 0
s_enemy1 = 0
s_enemy2 = 0
s_enemy3 = 0
enemy_step = 0
s_tips = 0

# === Initialize Sprites ===
s_enemy1 = cyberpi.sprite()
s_enemy2 = cyberpi.sprite()
s_enemy3 = cyberpi.sprite()
s_bullet = cyberpi.sprite()
s_aircraft = cyberpi.sprite()
s_tips = cyberpi.sprite()
s_scroe = cyberpi.sprite()

@event.start
def on_start():
    global aircraft_step, game_sta, bullet_start, score
    global s_scroe, s_bullet, s_aircraft, s_enemy1, s_enemy2, s_enemy3, enemy_step, s_tips

    cyberpi.background.fill(0, 0, 0)
    aircraft_step = 4
    bullet_start = cyberpi.controller.get_count('a')
    game_sta = 'ON'
    score = 0

    s_enemy1.draw_pixels([
        0x111111,0x111111,0x111111,0x111111,0xb711e5,0xb711e5,0xb711e5,0xb711e5,
        0xb711e5,0xb711e5,0xb711e5,0xb711e5,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0xb711e5,0xb711e5,0xb711e5,0xb711e5,0xb711e5,
        0xb711e5,0xb711e5,0xb711e5,0xb711e5,0xb711e5,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0xb711e5,0xb711e5,
        0xb711e5,0xb711e5,0xb711e5,0xb711e5,0xb711e5,0xb711e5,0xb711e5,0x111111,
        0x111111,0x111111,0x111111])
    s_enemy2.draw_pixels([
        0x111111,0x111111,0x111111,0x111111,0xff0000,0xff0000,0xff0000,0xff0000,
        0xff0000,0xff0000,0xff0000,0xff0000,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0xff0000,0xff0000,0xff0000,0xff0000,0xff0000,
        0xff0000,0xff0000,0xff0000,0xff0000,0xff0000,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0xff0000,0xff0000,
        0xff0000,0xff0000,0xff0000,0xff0000,0xff0000,0xff0000,0xff0000,0x111111,
        0x111111,0x111111,0x111111])
    s_enemy3.draw_pixels([
        0x111111,0x111111,0x111111,0x111111,0x8f0000,0x8f0000,0x8f0000,0x8f0000,
        0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x8f0000,
        0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,
        0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,
        0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0xffff00,0xffff00,0x2,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x2,0xffff00,0xffff00,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x8f0000,0x8f0000,
        0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x8f0000,0x111111,
        0x111111,0x111111,0x111111])
    s_bullet.draw_pixels([
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x2,0x2,0x2,0x2,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x2,
        0x2,0x2,0x2,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111])
    s_aircraft.draw_pixels([
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x2,0x2,0x2,
        0x2,0x2,0x2,0x2,0x2,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,0x111111,
        0x111111,0x111111,0x111111,0x111111])

    s_aircraft.set_size(150)

    restart()

    while True:
        bullet_start = cyberpi.controller.get_count('a')
        game_sta = 'ON'
        score = 0

        while game_sta == 'ON':
            aircraft_move()
            bullet_move()
            enemy_move()
            detection()
            cyberpi.screen.render()
            time.sleep(0.02)

        s_tips.show()
        s_tips.draw_text('GAME OVER')
        cyberpi.screen.render()
        time.sleep(5)
        restart()


def restart():
    global aircraft_step, game_sta, bullet_start, score
    global s_scroe, s_bullet, s_aircraft, s_enemy1, s_enemy2, s_enemy3, enemy_step, s_tips

    s_tips.set_brush(255, 255, 255)
    if cyberpi.get_language() == 'chinese':
        s_tips.draw_text('按 A 开始')
    else:
        s_tips.draw_text('Press A to start')
    
    s_tips.show()
    s_aircraft.move_to(64, 112)
    s_scroe.draw_text('0')
    s_scroe.move_to(115, 16)
    s_scroe.set_brush(5, 166, 255)
    s_bullet.move_to(s_aircraft.get_x(), s_aircraft.get_y() - 16)
    s_bullet.show()

    # Move enemies to start positions
    s_enemy1.move_to(random.randint(10, 118), 0)
    s_enemy2.move_to(random.randint(10, 118), 0)
    s_enemy3.move_to(random.randint(10, 118), 0)

    cyberpi.screen.render()

    while not cyberpi.controller.is_press('a'):
        pass  # wait for player to press A
    s_tips.hide()


def enemy_move():
    global s_enemy1, s_enemy2, s_enemy3

    for enemy in [s_enemy1, s_enemy2, s_enemy3]:
        enemy.move_y(random.randint(1, 3))
        enemy.set_size(100 + enemy.get_y() % 50)

        if enemy.get_y() > 127:
            enemy.move_to(random.randint(10, 118), random.randint(-50, -10))


def aircraft_move():
    if cyberpi.controller.is_press('up'):
        s_aircraft.move_y(-aircraft_step)
    elif cyberpi.controller.is_press('down'):
        s_aircraft.move_y(aircraft_step)
    elif cyberpi.controller.is_press('left'):
        s_aircraft.move_x(-aircraft_step)
    elif cyberpi.controller.is_press('right'):
        s_aircraft.move_x(aircraft_step)


def bullet_move():
    global bullet_start

    if cyberpi.controller.get_count('a') != bullet_start:
        s_bullet.show()
        s_bullet.move_to(s_aircraft.get_x(), s_aircraft.get_y() - 16)
        bullet_start = cyberpi.controller.get_count('a')
    else:
        if s_aircraft.get_y() < 0:
            s_bullet.hide()
            s_bullet.move_to(s_aircraft.get_x(), s_aircraft.get_y())
        else:
            s_bullet.move_y(-10)


def detection():
    global score, game_sta

    for enemy in [s_enemy1, s_enemy2, s_enemy3]:
        if s_bullet.is_touch(enemy):
            enemy.move_to(0, 255)
            s_bullet.hide()
            s_bullet.move_to(s_aircraft.get_x(), s_aircraft.get_y())
            score += 1
            s_scroe.draw_text(str(score))
            cyberpi.audio.play('prompt-tone')

    for enemy in [s_enemy1, s_enemy2, s_enemy3]:
        if s_aircraft.is_touch(enemy):
            cyberpi.audio.play_until('spitfire')
            game_sta = 'GAME OVER'
